// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Belt_Array from "@rescript/runtime/lib/es6/Belt_Array.js";
import * as Belt_SetInt from "@rescript/runtime/lib/es6/Belt_SetInt.js";
import * as Belt_SetString from "@rescript/runtime/lib/es6/Belt_SetString.js";
import * as Stdlib_Promise from "@rescript/runtime/lib/es6/Stdlib_Promise.js";
import * as JsxRuntime from "react/jsx-runtime";
import * as Primitive_exceptions from "@rescript/runtime/lib/es6/Primitive_exceptions.js";

function App(props) {
  let levelMatchesSelection = (selectedLevels, levelOpt) => {
    if (levelOpt !== undefined) {
      return Belt_SetInt.has(selectedLevels, levelOpt);
    } else {
      return false;
    }
  };
  let match = React.useState(() => {});
  let setDivisions = match[1];
  let divisions = match[0];
  let match$1 = React.useState(() => {});
  let setError = match$1[1];
  let error = match$1[0];
  let match$2 = React.useState(() => "");
  let setFilterText = match$2[1];
  let filterText = match$2[0];
  let match$3 = React.useState(() => "");
  let setDebouncedFilterText = match$3[1];
  let match$4 = React.useState(() => {});
  let setExpanded = match$4[1];
  let expanded = match$4[0];
  let match$5 = React.useState(() => {});
  let setExpandedItems = match$5[1];
  let expandedItems = match$5[0];
  let match$6 = React.useState(() => Belt_SetInt.fromArray([
    1,
    2,
    3,
    4,
    5
  ]));
  let setSelectedLevels = match$6[1];
  let selectedLevels = match$6[0];
  let match$7 = React.useState(() => true);
  let setShowHeaders = match$7[1];
  let showHeaders = match$7[0];
  let match$8 = React.useState(() => {});
  let setFocusedDivisionKey = match$8[1];
  let focusedDivisionKey = match$8[0];
  let match$9 = React.useState(() => false);
  let setShowAllDivisions = match$9[1];
  let showAllDivisions = match$9[0];
  let divisionKey = (prefix, division) => {
    let slug = division.href !== "" ? division.href : division.title;
    return prefix + "/division/" + slug;
  };
  let sectionKey = (prefix, section) => prefix + "/section/" + section.title + "#" + section.level.toString();
  let itemKey = (prefix, link) => {
    let slug = link.href !== "" ? link.href : link.title;
    return prefix + "/item/" + slug;
  };
  let collectSectionKeys = (sections, prefix, acc) => Belt_Array.reduce(sections, acc, (acc, section) => {
    let key = sectionKey(prefix, section);
    let nextAcc = Belt_SetString.add(acc, key);
    return collectSectionKeys(section.children, key, nextAcc);
  });
  let collectItemKeys = (items, prefix, acc) => Belt_Array.reduce(items, acc, (acc, item) => {
    let key = itemKey(prefix, item);
    let nextAcc = Belt_SetString.add(acc, key);
    return collectItemKeys(item.children, key, nextAcc);
  });
  let collectAllItemKeys = (sections, prefix, acc) => Belt_Array.reduce(sections, acc, (acc, section) => {
    let key = sectionKey(prefix, section);
    let nextAcc = collectItemKeys(section.items, key, acc);
    return collectAllItemKeys(section.children, key, nextAcc);
  });
  let collectDivisionKeys = (divisions, prefix, acc) => Belt_Array.reduce(divisions, acc, (acc, division) => {
    let key = divisionKey(prefix, division);
    let nextAcc = Belt_SetString.add(acc, key);
    let nextSections = collectSectionKeys(division.sections, key, nextAcc);
    return collectDivisionKeys(division.children, key, nextSections);
  });
  let collectDivisionItemKeys = (divisions, prefix, acc) => Belt_Array.reduce(divisions, acc, (acc, division) => {
    let key = divisionKey(prefix, division);
    let nextAcc = collectAllItemKeys(division.sections, key, acc);
    return collectDivisionItemKeys(division.children, key, nextAcc);
  });
  React.useEffect(() => {
    Stdlib_Promise.$$catch(fetch("/vitals-level5.json").then(response => {
      if (response.ok) {
        return response.json();
      } else {
        return Promise.reject(Primitive_exceptions.internalToException("Failed to load vitals-level5.json"));
      }
    }).then(payload => {
      let divisions = payload.divisions;
      setDivisions(param => divisions);
      setExpanded(param => {});
      setExpandedItems(param => {});
      setFocusedDivisionKey(param => {});
      setShowAllDivisions(param => false);
      return Promise.resolve();
    }), param => {
      setError(param => "Failed to load the Vital Articles list.");
      return Promise.resolve();
    });
  }, []);
  React.useEffect(() => {
    let timeoutId = setTimeout(() => setDebouncedFilterText(param => filterText), 500);
    return () => {
      clearTimeout(timeoutId);
    };
  }, [filterText]);
  let renderLink = (link, keyPrefix) => {
    let hasHref = link.href !== "";
    let href = "https://en.wikipedia.org" + link.href;
    let key = itemKey(keyPrefix, link);
    let isOpen = Belt_SetString.has(expandedItems, key);
    let level = link.level;
    return JsxRuntime.jsxs("li", {
      children: [
        JsxRuntime.jsxs("div", {
          children: [
            JsxRuntime.jsxs("span", {
              children: [
                hasHref ? JsxRuntime.jsx("a", {
                    children: link.title,
                    className: "text-sky-700 hover:text-sky-900 underline decoration-sky-300",
                    href: href,
                    rel: "noreferrer",
                    target: "_blank"
                  }) : JsxRuntime.jsx("span", {
                    children: link.title,
                    className: "text-stone-700"
                  }),
                level !== undefined && level !== 5 ? JsxRuntime.jsx("span", {
                    children: level.toString(),
                    className: "ml-1"
                  }) : null
              ]
            }),
            link.children.length !== 0 ? JsxRuntime.jsx("button", {
                children: isOpen ? "−" : "+",
                className: "rounded border-stone-200 px-2 py-1 text-[10px] font-semibold text-stone-600 hover:border-stone-300",
                onClick: param => setExpandedItems(prev => {
                  if (Belt_SetString.has(prev, key)) {
                    return Belt_SetString.remove(prev, key);
                  } else {
                    return Belt_SetString.add(prev, key);
                  }
                })
              }) : null
          ],
          className: "flex items-center gap-2"
        }),
        link.children.length !== 0 && isOpen ? JsxRuntime.jsx("ul", {
            children: Belt_Array.map(link.children, child => renderLink(child, key)),
            className: "ml-5 mt-2 list-disc text-sm text-stone-600"
          }) : null
      ],
      className: "my-1"
    }, key);
  };
  let query = match$3[0].toLowerCase();
  let isAllLevelsSelected = Belt_SetInt.size(selectedLevels) === 5;
  let filterSection = section => {
    let titleMatch = section.title.toLowerCase().includes(query);
    let filterItem = item => {
      let levelMatch = levelMatchesSelection(selectedLevels, item.level);
      let itemMatch = item.title.toLowerCase().includes(query);
      let children = Belt_Array.keepMap(item.children, filterItem);
      if (levelMatch && (query === "" || itemMatch) || children.length !== 0) {
        return {
          title: item.title,
          href: item.href,
          level: item.level,
          children: children
        };
      }
    };
    let items = Belt_Array.keepMap(section.items, filterItem);
    let children = Belt_Array.keepMap(section.children, filterSection);
    if (query === "") {
      if (items.length !== 0 || children.length !== 0) {
        return {
          title: section.title,
          level: section.level,
          items: items,
          children: children
        };
      } else {
        return;
      }
    } else if (titleMatch || items.length !== 0 || children.length !== 0) {
      return {
        title: section.title,
        level: section.level,
        items: items,
        children: children
      };
    } else {
      return;
    }
  };
  let filterDivision = division => {
    let titleMatch = division.title.toLowerCase().includes(query);
    let sections = Belt_Array.keepMap(division.sections, filterSection);
    let children = Belt_Array.keepMap(division.children, filterDivision);
    if (query === "") {
      if (sections.length !== 0 || children.length !== 0) {
        return {
          title: division.title,
          href: division.href,
          sections: sections,
          children: children
        };
      } else {
        return;
      }
    } else if (titleMatch || sections.length !== 0 || children.length !== 0) {
      return {
        title: division.title,
        href: division.href,
        sections: sections,
        children: children
      };
    } else {
      return;
    }
  };
  let toggleExpanded = key => setExpanded(prev => {
    if (Belt_SetString.has(prev, key)) {
      return Belt_SetString.remove(prev, key);
    } else {
      return Belt_SetString.add(prev, key);
    }
  });
  let expandAll = () => {
    if (divisions !== undefined) {
      setExpanded(param => collectDivisionKeys(divisions, "root", undefined));
      return setExpandedItems(param => collectDivisionItemKeys(divisions, "root", undefined));
    }
  };
  let renderSection = (section, keyPrefix, depth) => {
    let key = sectionKey(keyPrefix, section);
    let isOpen = Belt_SetString.has(expanded, key);
    if (showHeaders) {
      return JsxRuntime.jsxs("div", {
        children: [
          JsxRuntime.jsxs("div", {
            children: [
              JsxRuntime.jsx("span", {
                children: section.title
              }),
              JsxRuntime.jsx("button", {
                children: isOpen ? "−" : "+",
                className: "rounded border-stone-200 px-2 py-1 text-xs font-semibold text-stone-600 hover:border-stone-300",
                onClick: param => toggleExpanded(key)
              })
            ],
            className: "flex items-center gap-2 font-semibold text-stone-800"
          }),
          isOpen ? JsxRuntime.jsxs("div", {
              children: [
                section.items.length !== 0 ? JsxRuntime.jsx("ul", {
                    children: Belt_Array.map(section.items, item => renderLink(item, key)),
                    className: "ml-8 list-disc text-sm text-stone-700"
                  }) : null,
                section.children.length !== 0 ? JsxRuntime.jsx("div", {
                    children: Belt_Array.map(section.children, child => renderSection(child, key, depth + 1 | 0)),
                    className: " border-stone-200"
                  }) : null
              ]
            }) : null
        ],
        className: depth === 0 ? "" : "ml-4"
      }, key);
    } else {
      return JsxRuntime.jsxs("div", {
        children: [
          section.items.length !== 0 ? JsxRuntime.jsx("ul", {
              children: Belt_Array.map(section.items, item => renderLink(item, key)),
              className: "ml-4 list-disc text-sm text-stone-700"
            }) : null,
          section.children.length !== 0 ? JsxRuntime.jsx("div", {
              children: Belt_Array.map(section.children, child => renderSection(child, key, depth + 1 | 0)),
              className: " border-stone-200"
            }) : null
        ]
      }, key);
    }
  };
  let renderDivision = (division, keyPrefix, depth) => {
    let key = divisionKey(keyPrefix, division);
    let isOpen = Belt_SetString.has(expanded, key);
    if (showHeaders) {
      return JsxRuntime.jsxs("div", {
        children: [
          JsxRuntime.jsxs("div", {
            children: [
              JsxRuntime.jsx("span", {
                children: division.title
              }),
              JsxRuntime.jsx("button", {
                children: isOpen ? "−" : "+",
                className: "rounded border-stone-200 px-2 py-1 text-xs font-semibold text-stone-600 hover:border-stone-300",
                onClick: param => toggleExpanded(key)
              })
            ],
            className: "flex items-center gap-2 font-semibold text-stone-900"
          }),
          isOpen ? JsxRuntime.jsxs("div", {
              children: [
                division.sections.length !== 0 ? JsxRuntime.jsx("ul", {
                    children: Belt_Array.map(division.sections, section => renderSection(section, key, 0)),
                    className: "ml-2 list-disc text-sm text-stone-700"
                  }) : null,
                division.children.length !== 0 ? JsxRuntime.jsx("div", {
                    children: Belt_Array.map(division.children, child => renderDivision(child, key, depth + 1 | 0)),
                    className: "border-stone-200"
                  }) : null
              ]
            }) : null
        ],
        className: depth === 0 ? "" : "ml-4"
      }, key);
    } else {
      return JsxRuntime.jsxs("div", {
        children: [
          division.sections.length !== 0 ? JsxRuntime.jsx("ul", {
              children: Belt_Array.map(division.sections, section => renderSection(section, key, 0)),
              className: "ml-4 list-disc text-sm text-stone-700"
            }) : null,
          division.children.length !== 0 ? JsxRuntime.jsx("div", {
              children: Belt_Array.map(division.children, child => renderDivision(child, key, depth + 1 | 0)),
              className: "border-stone-200"
            }) : null
        ]
      }, key);
    }
  };
  let renderFocusedDivision = (division, keyPrefix) => {
    let key = divisionKey(keyPrefix, division);
    return JsxRuntime.jsxs("div", {
      children: [
        division.sections.length !== 0 ? JsxRuntime.jsx("ul", {
            children: Belt_Array.map(division.sections, section => renderSection(section, key, 0)),
            className: "list-disc text-sm text-stone-700"
          }) : null,
        division.children.length !== 0 ? JsxRuntime.jsx("div", {
            children: Belt_Array.map(division.children, child => renderDivision(child, key, 0)),
            className: "border-stone-200"
          }) : null
      ]
    });
  };
  let renderDivisionNav = (division, keyPrefix) => {
    let key = divisionKey(keyPrefix, division);
    let hasChildren = division.children.length !== 0;
    return JsxRuntime.jsxs("li", {
      children: [
        JsxRuntime.jsx("div", {
          children: JsxRuntime.jsx("button", {
            children: division.title,
            className: "text-left text-sm font-semibold text-stone-800 hover:text-sky-700",
            onClick: param => {
              setFocusedDivisionKey(param => key);
              setShowAllDivisions(param => false);
            }
          }),
          className: "flex items-center gap-2"
        }),
        hasChildren ? JsxRuntime.jsx("ul", {
            children: Belt_Array.map(division.children, child => renderDivisionNav(child, key)),
            className: "ml-4 list-disc text-sm text-stone-800"
          }) : null
      ],
      className: "my-1  text-sm text-stone-800"
    }, key);
  };
  let findDivisionByKey = (divisions, targetKey, prefix) => Belt_Array.reduce(divisions, undefined, (acc, division) => {
    if (acc !== undefined) {
      return acc;
    }
    let key = divisionKey(prefix, division);
    if (key === targetKey) {
      return [
        division,
        prefix
      ];
    } else {
      return findDivisionByKey(division.children, targetKey, key);
    }
  });
  React.useEffect(() => {
    if (divisions !== undefined) {
      if (showAllDivisions) {
        setExpanded(param => collectDivisionKeys(divisions, "root", undefined));
        setExpandedItems(param => collectDivisionItemKeys(divisions, "root", undefined));
      } else if (focusedDivisionKey !== undefined) {
        let match = findDivisionByKey(divisions, focusedDivisionKey, "root");
        if (match !== undefined) {
          let prefix = match[1];
          let division = match[0];
          setExpanded(param => collectDivisionKeys([division], prefix, undefined));
          setExpandedItems(param => collectDivisionItemKeys([division], prefix, undefined));
        }
      }
    }
  }, [
    focusedDivisionKey,
    divisions,
    showAllDivisions
  ]);
  let tmp;
  if (error !== undefined) {
    tmp = JsxRuntime.jsx("div", {
      children: error,
      className: "rounded border border-red-200 bg-red-50 p-3 text-sm text-red-700"
    });
  } else if (divisions !== undefined) {
    let visibleDivisions = query === "" && isAllLevelsSelected ? divisions : Belt_Array.keepMap(divisions, filterDivision);
    if (focusedDivisionKey !== undefined) {
      let match$10 = findDivisionByKey(visibleDivisions, focusedDivisionKey, "root");
      if (match$10 !== undefined) {
        let division = match$10[0];
        tmp = JsxRuntime.jsxs("div", {
          children: [
            JsxRuntime.jsxs("div", {
              children: [
                JsxRuntime.jsx("button", {
                  children: "All divisions",
                  className: "rounded border border-stone-200 bg-white px-3 py-1 text-xs font-semibold uppercase tracking-wider text-stone-600 hover:border-stone-300",
                  onClick: param => {
                    setFocusedDivisionKey(param => {});
                    setShowAllDivisions(param => false);
                  }
                }),
                JsxRuntime.jsx("span", {
                  children: division.title,
                  className: "text-sm font-semibold text-stone-800"
                })
              ],
              className: "mb-4 flex items-center gap-3"
            }),
            renderFocusedDivision(division, match$10[1])
          ],
          className: "rounded border-stone-100 bg-white"
        });
      } else {
        tmp = JsxRuntime.jsx("div", {
          children: "That division is no longer available.",
          className: "rounded border-stone-100 bg-white p-4 text-sm text-stone-600"
        });
      }
    } else {
      tmp = showAllDivisions ? JsxRuntime.jsxs("div", {
          children: [
            JsxRuntime.jsxs("div", {
              children: [
                JsxRuntime.jsx("button", {
                  children: "Divisions",
                  className: "rounded border border-stone-200 bg-white px-3 py-1 text-xs font-semibold uppercase tracking-wider text-stone-600 hover:border-stone-300",
                  onClick: param => setShowAllDivisions(param => false)
                }),
                JsxRuntime.jsx("span", {
                  children: "All divisions",
                  className: "text-sm font-semibold text-stone-800"
                })
              ],
              className: "mb-4 flex items-center gap-3"
            }),
            Belt_Array.map(visibleDivisions, division => renderDivision(division, "root", 0))
          ],
          className: "rounded border-stone-100 bg-white p-4"
        }) : JsxRuntime.jsxs("div", {
          children: [
            JsxRuntime.jsx("p", {
              children: "Divisions",
              className: "mb-3 text-xs uppercase tracking-widest text-stone-500"
            }),
            JsxRuntime.jsx("ul", {
              children: Belt_Array.map(visibleDivisions, division => renderDivisionNav(division, "root")),
              className: "list-disc"
            }),
            JsxRuntime.jsx("div", {
              children: JsxRuntime.jsx("button", {
                children: "All (slow)",
                className: "rounded border border-stone-200 bg-white px-3 py-2 text-xs font-semibold uppercase tracking-wider text-stone-600 hover:border-stone-300",
                onClick: param => {
                  setShowAllDivisions(param => true);
                  setFocusedDivisionKey(param => {});
                }
              }),
              className: "mt-4"
            })
          ],
          className: "rounded border-stone-100 bg-white p-4"
        });
    }
  } else {
    tmp = JsxRuntime.jsx("div", {
      children: "Loading divisions…",
      className: "text-sm text-stone-500"
    });
  }
  return JsxRuntime.jsxs("div", {
    children: [
      JsxRuntime.jsxs("div", {
        children: [
          JsxRuntime.jsx("p", {
            children: "Wikipedia Vital Articles",
            className: "text-sm uppercase tracking-widest text-stone-500"
          }),
          JsxRuntime.jsxs("div", {
            children: [
              JsxRuntime.jsx("input", {
                className: "w-full rounded-xl border border-stone-200 bg-white px-4 py-3 text-sm text-stone-700 shadow-sm focus:border-sky-300 focus:outline-none",
                placeholder: "Filter sections or articles",
                value: filterText,
                onChange: event => setFilterText(param => event.target.value)
              }),
              JsxRuntime.jsxs("div", {
                children: [
                  Belt_Array.map([
                    1,
                    2,
                    3,
                    4,
                    5
                  ], level => {
                    let isSelected = Belt_SetInt.has(selectedLevels, level);
                    return JsxRuntime.jsx("button", {
                      children: "Level " + level.toString(),
                      className: "rounded-lg border px-3 py-2 text-xs font-semibold uppercase tracking-wider " + (
                        isSelected ? "border-sky-300 bg-sky-50 text-sky-800" : "border-stone-200 bg-white text-stone-600 hover:border-stone-300"
                      ),
                      onClick: param => setSelectedLevels(prev => {
                        if (Belt_SetInt.has(prev, level)) {
                          return Belt_SetInt.remove(prev, level);
                        } else {
                          return Belt_SetInt.add(prev, level);
                        }
                      })
                    }, level.toString());
                  }),
                  JsxRuntime.jsx("button", {
                    children: showHeaders ? "Hide headers" : "Show headers",
                    className: "rounded-lg border px-3 py-2 text-xs font-semibold uppercase tracking-wider " + (
                      showHeaders ? "border-stone-200 bg-white text-stone-600 hover:border-stone-300" : "border-sky-300 bg-sky-50 text-sky-800"
                    ),
                    onClick: param => setShowHeaders(prev => !prev)
                  }),
                  JsxRuntime.jsx("button", {
                    children: "Expand all",
                    className: "rounded-lg border border-stone-200 bg-white px-3 py-2 text-xs font-semibold uppercase tracking-wider text-stone-600 hover:border-stone-300",
                    onClick: param => expandAll()
                  }),
                  JsxRuntime.jsx("button", {
                    children: "Collapse all",
                    className: "rounded-lg border border-stone-200 bg-white px-3 py-2 text-xs font-semibold uppercase tracking-wider text-stone-600 hover:border-stone-300",
                    onClick: param => {
                      setExpanded(param => {});
                      setExpandedItems(param => {});
                    }
                  })
                ],
                className: "flex flex-wrap gap-2"
              })
            ],
            className: "mt-4 flex flex-col gap-3 md:flex-row md:items-center"
          })
        ],
        className: "mb-8"
      }),
      tmp
    ],
    className: "mx-auto max-w-5xl p-6"
  });
}

let make = App;

export {
  make,
}
/* react Not a pure module */
